<!DOCTYPE HTML>
<html>

<head>  
	<style type="text/css">
		body {
			background-color: #eeeeee
		}

		label {
			display: inline-block;
			float: left;
			clear: left;
			width: 100px;
			text-align: right;
		}

		select {
			display: inline-block;
			float: left;
		}

		label, select {
			margin: 5px;
		}

		#loading {
			width: 500px;
			display: inline-block;
		}

		#loading > img {
			vertical-align: middle;
		}

		#loading > span {			
			font-size: 28pt;
			display: inline-block;
  			vertical-align: middle;
		}

		.clearfix:after {
			content: " "; /* Older browser do not support empty content */
			visibility: hidden;
			display: block;
			height: 0;
			clear: both;
		}		

		.confidences {
			float:left; 
			margin: 10px;
		}

		.hidden {
			display: none;
		}
	</style>
	<script type="text/javascript" src="/jquery.min.js"></script>
	<script type="text/javascript" src="/canvasjs.min.js"></script>
	<script type="text/javascript">		

		defaultDataset = 'oneshot';
		defaultLabels = 'cc';
		defaultReduction = 'sne'; 

		function updateChart(dataset, labels, reduction)
		{
			$.getJSON("http://localhost:4242/json?data=" + dataset + "&labels=" + labels + "&reduction=" + reduction, function(result)
			{

				var chart = new CanvasJS.Chart("chartContainer",
				{			
					backgroundColor: "#eeeeee",
					axisX:
					{
						lineThickness: 0,
						tickThickness: 0,
						gridThickness: 0,
						valueFormatString: " "
					},
					axisY:
					{
						lineThickness: 0,
						tickThickness: 0,
						gridThickness: 0,
						valueFormatString: " "					
					},
					data: [
					{        
						markerSize: 4,
						type: "scatter",  
						dataPoints: result.mat,
					}
					],
					zoomEnabled: true,
					zoomType: "xy"
					
				});				

				chart.render();

			});
		}

		function updateForm()
		{
			$.getJSON("http://localhost:4242/json?info=1", function(result)
			{				

				if (result.datasets.length == 0)
				{
					$('#datasetForm').hide();
					$('#loading').show();
					setTimeout(updateForm, 1000);
					return;
				}


				var curNumDatasets = $('select#dataset').children().length;
				if (result.datasets.length <= curNumDatasets)
				{
					setTimeout(updateForm, 1000);
					return;
				}

				$('#loading').hide('');

				var oldVal = $('select#dataset').val();
				if (!oldVal)
					oldVal = defaultDataset;
				$('select#dataset').html('');
				for (var i in result.datasets)
				{
					$('select#dataset').append('<option value="' + result.datasets[i] + '">' + result.datasets[i] + '</option>');					
				}
				$('select#dataset').val(oldVal);

				var oldVal = $('select#labels').val();
				if (!oldVal)
					oldVal = defaultLabels;				
				$('select#labels').html('');
				for (var i in result.labels)
				{
					$('select#labels').append('<option value="' + result.labels[i] + '">' + result.labels[i] + '</option>');
				}
				$('select#labels').val(oldVal);

				var oldVal = $('select#reductions').val();
				if (!oldVal)
					oldVal = defaultReduction;				
				$('select#reductions').html('');
				for (var i in result.reductions)
				{
					$('select#reductions').append('<option value="' + result.reductions[i] + '">' + result.reductions[i] + '</option>');
				}
				$('select#reductions').val(oldVal);

				$('#datasetForm').show();				

				$('select#dataset').fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);

				setTimeout(updateForm, 1000);

			});
		}

		function updateConfidences()
		{
			$.getJSON("http://localhost:4242/stats", function(result)
			{	
				if (result.confidences_cc.length > 0)
				{
					$('#confidences-cc').show();
					$('#confidences-cc').html('');
					$('#confidences-cc').append("Connected components:<br>")
					for (var i in result.confidences_cc)
					{
						var k = result.confidences_cc[i].numClusters;	
						var c = result.confidences_cc[i].confidence;
						$('#confidences-cc').append("p(k = " + k + ") = " + c + "<br>");
					}
				}

				if (result.confidences_dip.length > 0)
				{
					$('#confidences-dip').show();
					$('#confidences-dip').html('');
					$('#confidences-dip').append("Dip-Means:<br>")
					for (var i in result.confidences_dip)
					{
						var k = result.confidences_dip[i].numClusters;	
						var c = result.confidences_dip[i].confidence;
						$('#confidences-dip').append("p(k = " + k + ") = " + c + "<br>");
					}
				}

				setTimeout(updateConfidences, 1000);

			});
		}

		$( document ).ready(function() 
		{	
			$('#datasetForm').hide();
			$('.confidences').hide();

			$(".param").on('change', function(evt) 
			{
				updateChart($("select#dataset").val(), $("select#labels").val(), $("select#reductions").val());
			});

			updateForm();
			updateConfidences();
			updateChart(defaultDataset, defaultLabels, defaultReduction);

		});		

	</script>

</head>
<body>
	<div id="loading">
		<span>No data to show, yet.<br/><img id="bb" src="/bb.gif" alt="Please wait..."/><br/>Please wait...</span>
	</div>
	<div class="confidences" id="confidences-cc">
	</div>
	<div class="confidences" id="confidences-dip">
	</div>		
	<div class="clearfix"></div>
	<form id="datasetForm" action="#">
		<label for="dataset">Data set: </label><select class="param" id="dataset" name="dataset"></select> <br/>
		<label for="labels">Labels: </label><select class="param" id="labels" name="labels"></select> <br/>
		<label for="reductions">Reductions: </label><select class="param" id="reductions" name="reductions"></select> <br/>
	</form>
	<div class="clearfix"></div>
	<div id="chartContainer" style="width: 500px; height: 500px;">
	</div>
</body>

</html>
